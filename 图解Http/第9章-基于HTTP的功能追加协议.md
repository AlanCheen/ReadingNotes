# 第9章-基于HTTP的功能追加协议

建立 HTTP 标准规范时，主要是想把 HTTP 当做 『传输 HTML 文档的协议』。

随时代发展， Web的用途更具多样性，如 SNS，HTTP 虽然能在功能上满足需求，但是**性能上却未必是最优的**，这是 **HTTP 本身的限制以及性能有限**。

所以出现了一些基于 HTTP 的协议。

<img src="http://ww4.sinaimg.cn/large/98900c07gw1fajff7fmrnj21kw1daamj.jpg"/>

## 消除 HTTP 瓶颈的 SPDY

Google 发布的` SPDY`（取自 SPeedY），其开发目标是**解决 HTTP 的性能瓶颈，缩短 Web 页面的加载时间（50%）**。

### HTTP 的瓶颈

Web 网站，服务端内容更新无法实时推送给客户端，而客户端实时去请求服务端，会非常频繁地去请求，可能造成大量的浪费（没更新）。

**HTTP的瓶颈**：

1. 一条连接上只可发送一个请求
2. 请求只能从客户端开始。客户端不可以接受除响应以外的指令。
3. 请求/响应首部未经压缩就发送。首部信息越多延迟越大。
4. 发送冗长的首部。每次互相发送相同的首部造成的浪费较多。
5. 可任意选择数据压缩格式。非强制压缩发送。

#### Ajax解决方案
Ajax，是一种有效利用 JavaScript 和 DOM 的操作 ，以达到局部 Web 页面替换加载的异步通信手段。  

优点：

1. 只更新一部分页面，响应中传输的数据量会因此而减少。

缺点：

1. 在实时获取服务器内容时，有可能会导致大量请求产生。
2. 未解决 HTTP 协议本身存在的问题。


#### Comet

Comet 接受到请求时，为了实现推送，会先将相应置于挂起状态，当服务端有内容更新时，再返回该响应。

优点：

1. 内容上可以实现实时更新

缺点：

1. 为了保留响应，一次连接的持续时间变长，为了维持连接会消耗更多的资源。
2. 未解决 HTTP 协议本身存在的问题。


### SPDY 的设计与功能

HTTP协议本身的限制令人有些束手无策，为了根本性的改善，需要有一些**协议层面上的改动**。

SPDY 没有完全改写 HTTP协议，而是在 TCP/IP 的应用层与传输层之间通过新加『会话层』的形式运作；并规定通信中使用 SSL 保证安全。

应用层 HTTP
**会话层 SPDY**
**表示层 SSL**
传输层 TCP

#### SPDY 的功能

使用 SPDY 后使得 HTTP 获得了新的功能：

1. 多路复用 
2. 赋予请求优先级
3. 压缩 HTTP 首部
4. 推送功能
5. 服务器提示功能


#### SPDY 的不足

只是将单个域名的通信复用（当一个网站使用多个域名下的资源，改善效果会收到限制）。

### 使用浏览器进行全双工通信的 WebSocket

Ajax 和 Comet 技术可以提升 Web 的浏览速度，但问题在于若通信使用 HTTP 协议，就无法彻底解决瓶颈问题。

WebSocket 网络技术正是为解决这些问题而实现的一套新协议及API。

WebSocket 即 **Web浏览器与 Web服务器之间全双工通信标准**。

主要是为了 **解决Ajax 和 Comet 里 XMLHTTPRequest 附带的缺陷所引起的问题。**


在建立连接的时候，**发起方依然是客户端**。不过客户端跟服务端一旦建立连接，就可以**相互发送** JSON、XML、HTML或图片等任意格式的数据。

**WebSocket的特点**：

1. **推送功能** 。支持服务端向客户端推送数据。
2. **减少通信量**。  建立连接后，希望一直保持连接状态，而且首部信息很小，所以通信量也少了。


其他记录：

需要完成一次握手的步骤。

WebSocket实现通信，使用了 Upgrade 首部字段。


### 期盼已久的 HTTP/2.0

HTTP/2.0的目标是改善用户在使用 Web 时的速度体验。

**HTTP/2.0的7项技术及讨论**

1. 压缩
2. 多路复用
3. TLS 义务化
4. 协商
5. 客户端拉拽(pull)/服务端推送(push)
6. 流量控制
7. WebSocket


### Web服务管理文件的 WebDAV

WebDAV(Web-based Distributed Authoring and Versioning,基于万维网的分布式创作和版本控制)是一个可对 Web服务器上的内容直接进行文件复制、编辑等操作的分布式文件系统。（HTTP/1.1的扩展）

balabala 还有些 WebDAV 的内容，没记。
